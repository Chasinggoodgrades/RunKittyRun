import { Regions } from 'src/AutoGenerated/Regions'
import { Gameover } from 'src/Events/Gameover'
import { Globals } from 'src/Global/Globals'
import { Unit } from 'w3ts'

/// <summary>
/// Most of the following functions in this class , take the top 3 players and return them in a list
/// </summary>

export class PodiumUtil {
    public static SortPlayersByScore() {
        return Globals.ALL_PLAYERS.OrderByDescending(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.CurrentStats
            return stats.TotalSaves - stats.TotalDeaths
        })
            .Take(3)
            .ToList()
    }

    public static SortPlayersBySaves() {
        return Globals.ALL_PLAYERS.OrderByDescending(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.CurrentStats
            return stats.TotalSaves
        })
            .Take(3)
            .ToList()
    }

    public static SortPlayersByHighestRatio() {
        return Globals.ALL_PLAYERS.OrderByDescending(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.CurrentStats
            return stats.TotalDeaths == 0 ? stats.TotalSaves : stats.TotalSaves / stats.TotalDeaths
        })
            .Take(3)
            .ToList()
    }

    public static SortPlayersByHighestSaveStreak() {
        return Globals.ALL_PLAYERS.OrderByDescending(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.CurrentStats
            return stats.MaxSaveStreak
        })
            .Take(3)
            .ToList()
    }

    public static SortPlayersTopProgress() {
        return Globals.ALL_PLAYERS.OrderByDescending(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.TimeProg
            return stats.GetOverallProgress()
        })
            .Take(3)
            .ToList()
    }

    public static SortPlayersFastestTime() {
        return Globals.ALL_PLAYERS.OrderBy(player => {
            let stats = Globals.ALL_KITTIES.get(player)!.TimeProg
            return stats.GetTotalTime()
        })
            .Take(3)
            .ToList()
    }

    public static SetCameraToPodium() {
        for (let player of Globals.ALL_PLAYERS) {
            let podium = Regions.Podium_cinematic
            if (player.isLocal()) {
                SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, 1400.0, 0.0)
                PanCameraToTimed(podium.Center.x, podium.Center.y, 2.0)
            }
        }
    }

    public static ClearPodiumUnits(podiumUnits: Unit[]) {
        if (podiumUnits.length == 0) return
        for (let kitty in podiumUnits) {
            kitty.setPos(Regions.safe_Area_00.Center.x, Regions.safe_Area_00.Center.y)
            kitty.paused = false
        }
        podiumUnits.clear()
    }

    public static EndingGameThankyou() {
        print('{Colors.COLOR_YELLOW}to: everyone: for: playing: Thanks, love: much <3|r')
        Gameover.NotifyEndingGame()
    }

    public static PlacementString(placement: number) {
        switch (placement) {
            case 1:
                return '1st'

            case 2:
                return '2nd'

            case 3:
                return '3rd'

            default:
                return '{placement}th'
        }
    }
}
