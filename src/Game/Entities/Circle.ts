import { Constants } from 'src/AutoGenerated/Constants'
import { Regions } from 'src/AutoGenerated/Regions'
import { Globals } from 'src/Global/Globals'
import { Utility } from 'src/Utility/Utility'
import { MapPlayer, Trigger, Unit } from 'w3ts'
import { Kitty } from './Kitty/Kitty'

export class Circle {
    private CIRCLE_UNIT_MODEL = Constants.UNIT_KITTY_CIRCLE
    private static CIRCLE_SPAWN_REGION = Regions.Circle_Area
    private ID = 0
    public Player: MapPlayer
    public Unit: Unit
    public Collision: Trigger

    public constructor(player: MapPlayer) {
        this.Player = player
        this.ID = player.id
        this.Collision = Trigger.create()!
        this.CreateCircle()
    }

    private CreateCircle() {
        this.Unit = Unit.create(
            this.Player,
            this.CIRCLE_UNIT_MODEL,
            Circle.CIRCLE_SPAWN_REGION.centerX,
            Circle.CIRCLE_SPAWN_REGION.centerY
        )!
        Utility.MakeUnitLocust(this.Unit)
        Globals.ALL_CIRCLES.set(this.Player, this)
        this.Unit.show = false
    }

    public dispose() {
        this.Unit.destroy()
        this.Collision.destroy()
        Globals.ALL_CIRCLES.delete(this.Player)
    }

    public KittyDied(kitty: Kitty) {
        this.Unit.setPosition(kitty.Unit.x, kitty.Unit.y)
        this.ShowCircle()
    }

    public SetMana(mana: number, maxMana: number, regenRate: number) {
        this.Unit.mana = mana
        this.Unit.maxMana = maxMana
        BlzSetUnitRealField(this.Unit.handle, UNIT_RF_MANA_REGENERATION, regenRate)
    }

    public HideCircle() {
        return (this.Unit.show = false)
    }

    private ShowCircle() {
        return (this.Unit.show = true)
    }
}
