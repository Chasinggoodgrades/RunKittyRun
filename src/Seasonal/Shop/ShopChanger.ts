import { Constants } from 'src/AutoGenerated/Constants'
import { Globals } from 'src/Global/Globals'
import { GC } from 'src/Utility/GC'
import { getFilterUnit } from 'src/Utility/w3tsUtils'
import { Group } from 'w3ts'
import { HolidaySeasons, SeasonalManager } from '../SeasonalManager'

export class ShopChanger {
    private static SantaSkin: number = Constants.UNIT_SANTA
    private static HalloweenSkin: number
    private static ValentinesSkin: number
    private static EasterSkin: number
    private static NormalSkin: number = Constants.UNIT_KITTY_VENDOR

    public static Initialize() {
        if (SeasonalManager.Season == HolidaySeasons.None) return
        ShopChanger.SetSeasonalShop()
    }

    public static SetSeasonalShop() {
        switch (SeasonalManager.Season) {
            case HolidaySeasons.None:
                ShopChanger.SetShopsToSkin(ShopChanger.NormalSkin)
                break

            case HolidaySeasons.Christmas:
                ShopChanger.SetShopsToSkin(ShopChanger.SantaSkin)
                break
            /*            case HolidaySeasons.Halloween:
                                HalloweenShop();
                                break;

                            case HolidaySeasons.Easter:
                                EasterShop();
                                break;

                            case HolidaySeasons.Valentines:
                                ValentinesShop();
                                break;*/
        }
    }

    private static SetShopsToSkin(skinType: number) {
        let tempGroup = Group.create()!
        tempGroup.enumUnitsInRect(
            Globals.WORLD_BOUNDS,
            Filter(() => getFilterUnit().typeId == Constants.UNIT_KITTY_VENDOR)
        )
        while (true) {
            let vendor = tempGroup.first
            if (vendor == null) break
            tempGroup.removeUnit(vendor)
            vendor.skin = skinType
        }
        GC.RemoveGroup(tempGroup) // TODO; Cleanup:         GC.RemoveGroup(ref tempGroup);
    }
}
