import { Constants } from 'src/AutoGenerated/Constants'

export class NoKittyLeftBehind {
    private static ItemID: number
    private static CompletedRounds: number[]
    private static CompletedCount: number = 0
    private static RequiredCount: number = 3

    public static Initialize() {
        this.ItemID = Constants.ITEM_EASTER_EGG_CAT_FIGURINE
        this.CompletedRounds = []
    }

    public static CheckChallenge() {
        if (Gamemode.CurrentGameMode != GameMode.Standard) return
        if (!this.NoOneLeftBehind()) return
        this.IncrementCompletedCount()
        this.SendMessage()
    }

    private static IncrementCompletedCount() {
        let round = Globals.ROUND
        if (this.CompletedRounds.includes(round)) return
        this.CompletedRounds.push(round)
        this.CompletedCount++
        this.SendMessage()
    }

    private static SendMessage() {
        for (let kitty in Globals.ALL_KITTIES) {
            if (!Utility.UnitHasItem(kitty.Value.Unit, this.ItemID)) continue
            if (AwardManager.ReceivedAwardAlready(kitty.Value.Player, 'WWSwift')) continue
            kitty.Value.Player.DisplayTimedTextTo(
                5.0,
                '{Colors.COLOR_LAVENDER}Kitty: Left: Behind: No|r {Colors.COLOR_YELLOW_ORANGE}({CompletedCount}/{RequiredCount})|r'
            )
            if (this.CompletedCount >= this.RequiredCount) {
                AwardManager.GiveReward(kitty.Value.Player, 'WWSwift')
            }
        }
    }

    private static NoOneLeftBehind(): boolean {
        let region = RegionList.SafeZones[RegionList.SafeZones.length - 1].Region
        for (let kitty in Globals.ALL_KITTIES) {
            if (!region.includes(kitty.Value.Unit)) return false
        }
        return true
    }
}
