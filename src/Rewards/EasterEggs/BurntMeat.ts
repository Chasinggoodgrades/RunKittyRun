import { Constants } from 'src/AutoGenerated/Constants'
import { SpawnChampions } from 'src/Game/Entities/Champions/SpawnChampions'
import { Kitty } from 'src/Game/Entities/Kitty/Kitty'
import { ErrorHandler } from 'src/Utility/ErrorHandler'
import { RemoveItemFromUnit } from 'src/Utility/UnitUtility'
import { getTriggerUnit } from 'src/Utility/w3tsUtils'
import { Trigger, Unit } from 'w3ts'
import { AwardManager } from '../Rewards/AwardManager'

export class BurntMeat {
    public static StanDeath: Trigger = Trigger.create()!
    public static StanTurnIn: Trigger = Trigger.create()!
    public static StanDeathActions: triggeraction
    public static StanTurnInActions: triggeraction
    public static ITEM_CLOAK_FLAMES: number = Constants.ITEM_CLOAK_OF_FLAMES
    public static ITEM_BURNT_MEAT: number = Constants.ITEM_WOLF_MEAT
    public static Completed: Unit[] = []

    public static FlamesDropChance(k: Kitty) {
        let randomRoll = GetRandomInt(1, 100)
        if (randomRoll > 8) return // 8% chance
        k.Unit.addItemById(this.ITEM_CLOAK_FLAMES)
    }

    public static RegisterTurnInTrigger() {
        TriggerRegisterUnitInRangeSimple(this.StanTurnIn.handle, 200, SpawnChampions.Stan2025.handle)
        if (this.StanTurnInActions !== null) return
        this.StanTurnInActions = this.StanTurnIn.addAction(
            ErrorHandler.Wrap(() => {
                let unit = getTriggerUnit()
                let player = unit.owner
                if (!this.Completed.includes(unit)) return
                player.DisplayTimedTextTo(
                    8.0,
                    'vriend: Bedankt, moet: slide: eens: proberen: je! (friend: Thanks, should: try: slide: you!)'
                )
                // Violet Windwalk, awarded for killing stan with something, then taking some burnt meat n and turning it in.
                AwardManager.GiveReward(player, 'WWViolet')
                RemoveItemFromUnit(unit, this.ITEM_BURNT_MEAT)
                this.Completed.splice(this.Completed.indexOf(unit), 1)
            })
        )
    }
}
