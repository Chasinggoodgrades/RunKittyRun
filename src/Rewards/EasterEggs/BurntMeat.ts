import { Constants } from 'src/AutoGenerated/Constants'
import { SpawnChampions } from 'src/Game/Entities/Champions/SpawnChampions'
import { Kitty } from 'src/Game/Entities/Kitty/Kitty'
import { RemoveItemFromUnit } from 'src/Utility/UnitUtility'
import { getTriggerUnit } from 'src/Utility/w3tsUtils'
import { Trigger, Unit } from 'w3ts'
import { AwardManager } from '../Rewards/AwardManager'

export class BurntMeat {
    public static StanDeath: Trigger = Trigger.create()!
    public static StanTurnIn: Trigger = Trigger.create()!
    public static StanDeathActions: triggeraction
    public static StanTurnInActions: triggeraction
    public static ITEM_CLOAK_FLAMES: number = Constants.ITEM_CLOAK_OF_FLAMES
    public static ITEM_BURNT_MEAT: number = Constants.ITEM_WOLF_MEAT
    public static Completed: Unit[] = []

    public static FlamesDropChance(k: Kitty) {
        const randomRoll = GetRandomInt(1, 100)
        if (randomRoll > 8) return // 8% chance
        k.Unit.addItemById(BurntMeat.ITEM_CLOAK_FLAMES)
    }

    public static RegisterTurnInTrigger = () => {
        TriggerRegisterUnitInRangeSimple(BurntMeat.StanTurnIn.handle, 200, SpawnChampions.Stan2025.handle)
        if (BurntMeat.StanTurnInActions !== null) return
        BurntMeat.StanTurnInActions = BurntMeat.StanTurnIn.addAction(() => {
            const unit = getTriggerUnit()
            const player = unit.owner
            if (!BurntMeat.Completed.includes(unit)) return
            player.DisplayTimedTextTo(
                8.0,
                'Bedankt vriend, je moet slide eens proberen! (Thanks friend, you should try slide!)'
            )
            // Violet Windwalk, awarded for killing stan with something, then taking some burnt meat n and turning it in.
            AwardManager.GiveReward(player, 'WWViolet')
            RemoveItemFromUnit(unit, BurntMeat.ITEM_BURNT_MEAT)
            BurntMeat.Completed.splice(BurntMeat.Completed.indexOf(unit), 1)
        })
    }
}
