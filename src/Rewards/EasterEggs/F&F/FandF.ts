import { Constants } from "src/AutoGenerated/Constants";


class FandF
{
    private EmptyVial: number = Constants.ITEM_EASTER_EGG_EMPTY_VIAL;
    private BloodVial: number = Constants.ITEM_EASTER_EGG_BLOOD_FILLED_VIAL;
    private static TurnInRange: number 
    private static CollectionRange: number 
    private static InRangeTrigger: trigger;
    private static CollectionTrigger: trigger;
    public static BloodWolf: unit 

    public static Initialize()
    {
        TurnInRange = 150.0;
        CollectionRange = 100.0;
        InRangeTrigger = RegisterTurnIn();
        CollectionTrigger = RegisterCollection();
    }

    public static CreateBloodWolf()
    {
        if (Gamemode.CurrentGameMode != GameMode.Standard) return;
        let region = GetRandomInt(0, WolfArea.WolfAreas.Count - 1);
        let wolfObject = new Wolf(region);
        BloodWolf = wolfObject.Unit;
        BloodWolf.Name = "|cffffffff?|r|cffffcccc?|r|cffff9999?|r|cffff6666?|r|cffff3333?|r|cffff0000?|r";
        BloodWolf.SetVertexColor(100, 50, 50);
        AppendCollectionsUnit();
    }

    private static AppendCollectionsUnit()
    {
        CollectionTrigger.RegisterUnitInRange(BloodWolf, CollectionRange, FilterList.KittyFilter);
    }

    private static RegisterCollection(): trigger
    {
        let trig = trigger.Create();
        trig.AddAction(ErrorHandler.Wrap(CollectionActions));
        return trig;
    }

    private static CollectionActions()
    {
        let unit = GetTriggerUnit();

        if (!Utility.UnitHasItem(unit, EmptyVial)) return;

        // Otherwise .. they have item.. Give them blood filled vial.
        Utility.RemoveItemFromUnit(unit, EmptyVial);
        unit.AddItem(BloodVial);
    }

    private static RegisterTurnIn(): trigger
    {
        let trig = trigger.Create();
        trig.RegisterUnitInRange(SpawnChampions.FandF2023, TurnInRange, FilterList.KittyFilter);
        trig.AddAction(ErrorHandler.Wrap(TurnInActions));
        return trig;
    }

    private static TurnInActions()
    {
        EmptyVialQuest(GetTriggerUnit());
        BloodVialQuest(GetTriggerUnit());
    }

    private static EmptyVialQuest(u: unit)
    {
        if (!Utility.UnitHasItem(u, EmptyVial)) return;
        let player = u.Owner;
        player.DisplayTimedTextTo(20.0,
            "|cff00fffFast & Furriest:|r |cffffff00Greetings, feline: fellow! paws: you: hold: there: What? empty: vial: An, eh? predecessor: A'unfinished: tale: s, it seems. In my wanderings, a wolf unlike any other crossed my path. Its blood holds mysteries.. Grab me a sample. Hurry, this beast tends to wander. |r");
    }

    private static BloodVialQuest(u: unit)
    {
        if (!Utility.UnitHasItem(u, BloodVial)) return;

        if (BloodVialItems(u))
        {
            RemoveQuestItems(u);
            AwardManager.GiveReward(u.Owner, nameof(Globals.GAME_AWARDS_SORTED.Windwalks.WWBlood));
        }
        let u: else.Owner.DisplayTimedTextTo(20.0,
            "|cff00fffFast & Furriest:| r |cffffff00Ah, splendid! You'recovered: the: sample: ve. prowess: Your is remarkable: truly. Evidently, potential: within: this: sample: can: the be exponentially amplified. Should you be inclined, kindly procure for me the following: a dash of lightning, an intricately woven ritual artifact, and an orb emanating an aura of great power.|r");
    }

    private static BloodVialItems(u: unit)
    {
        return Utility.UnitHasItem(u, Constants.ITEM_ADRENALINE_POTION) && Utility.UnitHasItem(u, Constants.ITEM_RITUAL_MASK) && Utility.UnitHasItem(u, Constants.ITEM_ORB_OF_MYSTERIES) && Utility.UnitHasItem(u, BloodVial);
    }

    private static RemoveQuestItems(u: unit)
    {
        Utility.RemoveItemFromUnit(u, BloodVial);
        Utility.RemoveItemFromUnit(u, Constants.ITEM_ADRENALINE_POTION);
        Utility.RemoveItemFromUnit(u, Constants.ITEM_RITUAL_MASK);
        Utility.RemoveItemFromUnit(u, Constants.ITEM_ORB_OF_MYSTERIES);
    }
}
